package br.com.wmw.apigeraintegration.mapper;

import java.util.List;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;

import br.com.wmw.apigeraintegration.mapper.DynamicJsonMapper.CampoConfig;

@SpringBootTest
public class DynamicJsonMapperTest {

	@Test
	public void testMapeamentoObjetos() throws JsonMappingException, JsonProcessingException {
		String jsonPedido = getJsonPedido();
		ObjectMapper mapper = new ObjectMapper();
		JsonNode pedidoNode = mapper.readTree(jsonPedido);

		List<CampoConfig> campos = List.of(
				new CampoConfig("cdEmpresa", "codEmp",null),
				new CampoConfig("cdCondicaoPagamento", "codCondicaoPagamento",null),
//				new CampoConfig("qtPeso", "peso"),
//				new CampoConfig("itemPedidoList.itemTabelaPreco.vlMaxAcrescimo", "item.maxAcrescimo"),
//				new CampoConfig("itemPedidoList.nuSeqProduto", "item.nuSeqProduto"),
//				new CampoConfig("cdCliente", "cliente.cdCliente"),
				new CampoConfig("cliente.dsEstadoComercial", "cliente.estado", null));
		DynamicJsonMapper dynamicJsonMapper = new DynamicJsonMapper();
		String resultado = dynamicJsonMapper.mapJsonToOutput(pedidoNode, campos);

	}

	private String getJsonPedido() {
		return """
								{
				   "cdCondicaoPagamento":"28",
				   "vlPctDescFrete":0,
				   "dsObsOrcamento":"",
				   "dsObservacao":"",
				   "qtPeso":0,
				   "vlRentabilidadeSug":0,
				   "vlPctDescCliente":0,
				   "vlRentabSugItens":0,
				   "vlRentabilidadeTotal":0,
				   "cdTipoPedido":"1",
				   "vlTotalTrocaPedido":0,
				   "vlPctDescQuantidadePeso":0,
				   "qtDiasCPgtoLibSenha":0,
				   "vlCotacaoDolar":0,
				   "vlPctFrete":0,
				   "flPedidoNovoCliente":"S",
				   "vlPctDescItem":0,
				   "vlTotalComissaoExtra":0,
				   "vlTotalDescontoAuto":0,
				   "flOrigemPedido":"P",
				   "camposDinamicosClientePDA":{
				      "DSCEPCOMERCIAL":"",
				      "CDTIPOPAGAMENTO":"",
				      "DSPONTOREFERENCIA":"",
				      "CDTRANSPORTADORA":"",
				      "IC_DSCANAL":"",
				      "CDCONDICAOPAGAMENTO":"",
				      "NULOGRADOUROCOMERCIAL":"",
				      "FLENVIAEMAILCAMPANHA":"",
				      "CDCLIENTE":"",
				      "QTDIASMAXIMOPAGAMENTO":"",
				      "NUCNPJ":"",
				      "DSSITUACAO":"",
				      "NURG":"",
				      "NUFONEFAX":"",
				      "CDCATEGORIA":"",
				      "DSCIDADECOMERCIAL":"",
				      "DTULTIMOPEDIDO":"",
				      "NMFANTASIA":"",
				      "VLLIMITECREDITO":"",
				      "IC_CDCNAE":"",
				      "NMRAZAOSOCIAL":"",
				      "FLPERMITEMULTIPLOSENDERECOS":"",
				      "NMCONTATOPRINCIPAL":"",
				      "CDTIPOENTREGA":"",
				      "DSBAIRROCOMERCIAL":"",
				      "CDLONGITUDE":"",
				      "DSUFPRECO":"",
				      "NUFONE":"",
				      "IC_LINKMATERIAL":"",
				      "IC_DSSEGMENTO":"",
				      "DSCOMPLEMENTOCOMERCIAL":"",
				      "DSOBSERVACAO":"",
				      "DSNUMEROENDERECO":"",
				      "DSESTADOCOMERCIAL":"",
				      "DSEMAIL":"",
				      "DSLOGRADOUROCOMERCIAL":"",
				      "CDLATITUDE":"",
				      "CDTABELAPRECO":"",
				      "DSPAISCOMERCIAL":"",
				      "NUINSCRICAOESTADUAL":"",
				      "NUCELULAR":""
				   },
				   "cdCliente":"19791619000190",
				   "vlBaseMargemRentab":0,
				   "vlFreteAdicional":0,
				   "cdRepresentante":"513",
				   "vlVerbaGrupo":0,
				   "cliente":{
				      "vlLimiteCredito":0,
				      "vlIndiceFinanceiroCondPagto":0,
				      "cdLatitude":-14.6233321,
				      "nuDiasSemPedido":0,
				      "vlMaxPedido":0,
				      "vlVendaMensal":0,
				      "vlPctDevolucaoConsig":0,
				      "nuCnpj":"19791619000190",
				      "qtDiasMaximoPagamento":0,
				      "cdLongitude":-57.5002474,
				      "dsEstadoComercial":"12",
				      "vlIndiceFinanceiroEspecial":0,
				      "clienteSemCoo":false,
				      "qtDiasPrazoPagtoEstendido":0,
				      "nmRazaoSocial":"FENIX AVIACAO AGRICOLA LTDA",
				      "vlMaxTitulosAtraso":0,
				      "vlPctContratoCli":0,
				      "vlPctIcms":0,
				      "vlIndiceFinanceiro":0,
				      "nuFone":"32523523523",
				      "nuDiasPrevisaoEntrega":0,
				      "dtCadastro":"22/05/2025",
				      "vlPctMaxDesconto":0,
				      "vlMinPedido":0,
				      "vlIndiceComissao":0,
				      "cdCliente":"19791619000190",
				      "cdRepresentante":"513",
				      "vlLimiteCreditoConsig":0,
				      "nmFantasia":"FENIX AVIACAO AGRICOLA",
				      "dsBairroComercial":"testes",
				      "dsLogradouroComercial":"AVENIDA ISMAEL JOSE DO NASCIMENTO",
				      "cdEmpresa":"4",
				      "vlPctMinDesconto":0,
				      "nuDiasToleranciaAtraso":0,
				      "vlTicketMedio":0,
				      "vlTonFrete":0,
				      "dsCepComercial":"88735000"
				   },
				   "vlFreteTotal":0,
				   "cdEmpresa":"4",
				   "qtEncomenda":0,
				   "vlTotalCashback":0,
				   "nuKmInicial":0,
				   "vlTotalPedidoLiberado":0,
				   "vlVerbaPedidoPositivo":0,
				   "cdTipoPagamento":"5",
				   "vlFreteRepresentante":0,
				   "nuKmFinal":0,
				   "vlVerbaPedido":0,
				   "vlTotalItens":712.32,
				   "useLayoutViaClientePDA":false,
				   "vlTrocaEntregar":0,
				   "vlRentabTotalItens":0,
				   "cdStatusPedido":"1",
				   "vlDesconto":0,
				   "vlTotalPontuacaoRealizado":910.8,
				   "vlFinalPedidoDescTribFrete":0,
				   "vlBonificacaoPedido":0,
				   "vlCustoMargemRentab":0,
				   "qtPontosPedido":0,
				   "vlPctTotalMargem":28.57142857142857,
				   "vlPctComissaoTotal":0,
				   "vlVolumePedido":0,
				   "vlPctDesc3":0,
				   "flCalculaPontuacao":"N",
				   "vlPctDesc2":0,
				   "vlTotalCreditoCondicao":0,
				   "vlTotalEncomenda":0,
				   "vlDescontoTotalAutoDesc":0,
				   "vlPctDescontoCondicao":0,
				   "vlFrete":0,
				   "camposDinamicosPDA":{
				      "DSMENSAGEMENTREGA":"",
				      "CDTIPOPAGAMENTO":"5",
				      "VLTROCAENTREGAR":"0.00",
				      "IC_DSCANAL":"",
				      "CDMOTIVOACRESCIMOCUSTO":"",
				      "CDTIPOENTREGA":"",
				      "CDCONDICAOPAGAMENTO":"28",
				      "CDCLIENTE":"19791619000190",
				      "VLPCTACRESCIMOCUSTO":"0.00",
				      "CDTIPOPEDIDO":"1",
				      "FLORIGEMPEDIDORELACIONADO":"",
				      "VLTOTALITENS":"712.32",
				      "IC_DSSEGMENTO":"",
				      "CDEMPRESA":"4",
				      "VLPCTDESCPROGRESSIVO":"0.00",
				      "DSOBSERVACAO":"",
				      "VLTOTALPEDIDO":"712.32",
				      "DSDESTINO":"",
				      "VLCOTACAODOLAR":"0.00",
				      "QTPONTOSPEDIDO":"0",
				      "CDTABELAPRECO":"4",
				      "VLTOTALBRUTOITENS":"712.32",
				      "VLTROCARECOLHER":"0.00"
				   },
				   "dtEmissao":"11/07/2025",
				   "nuPedido":"6401152547",
				   "nuVersaoSistemaOrigem":"9.037-SNAPSHOT",
				   "vlPctDesconto":0,
				   "vlTotalNotaCredito":0,
				   "vlTotalCreditoFrete":0,
				   "vlPctDescontoAutoEfetivo":0,
				   "vlPctIndiceFinCondPagto":0,
				   "vlPctDescHistoricoVendas":0,
				   "vlTotalBrutoItens":712.32,
				   "vlTotalDevolucoes":0,
				   "vlTrocaRecolher":0,
				   "vlTotalPedido":712.32,
				   "vlPedidoOriginal":0,
				   "vlFreteCliente":0,
				   "vlDescontoIndiceFinanCliente":0,
				   "flAguardaPedidoComplementar":"N",
				   "vlPctMargemMin":0,
				   "cdUsuarioEmissao":"WMW",
				   "vlRentabilidade":0,
				   "vlVerbaFornecedor":0,
				   "vlPctAcrescimoItem":0,
				   "cdTabelaPreco":"4",
				   "vlPctDescProgressivo":0,
				   "vlPctFreteRepresentante":0,
				   "vlPctComissao":0,
				   "vlTotalPontuacaoBase":792,
				   "nuParcelas":0,
				   "vlPctMargemRentab":0,
				   "vlSeguroPedido":0,
				   "hrEmissao":"15:25",
				   "vlTotalBaseItens":712.32,
				   "vlPctDescProgressivoMix":0,
				   "itemPedidoList":[
				      {
				         "vlPctDescFrete":0,
				         "vlPctMargemAgregada":0,
				         "vlVolumeItem":0,
				         "vlTotalIcmsItem":0,
				         "vlCofins":0,
				         "cdItemGrade3":"0",
				         "qtItemPedidoUnElementar":0,
				         "vlPctVerbaRateio":0,
				         "vlReducaoOptanteSimples":0,
				         "vlCreditoCondicao":0,
				         "vlItemPedidoOrigem":0,
				         "nuSeqProduto":1,
				         "vlPctContratoCli":0,
				         "vlPctDescAlcada":0,
				         "cdItemGrade1":"0",
				         "cdItemGrade2":"0",
				         "nuPromocao":0,
				         "qtItemEstoquePositivo":0,
				         "vlTotalMargemItem":203.52,
				         "flOrigemPedido":"P",
				         "vlPosVinco9":0,
				         "vlVerbaGrupoItem":0,
				         "cdRepresentante":"513",
				         "qtdCreditoDesc":0,
				         "vlPctAcrescimo":0,
				         "vlUnidadePadrao":29.68,
				         "vlPctAcrescimoCondicao":0,
				         "cdEmpresa":"4",
				         "qtEncomenda":0,
				         "vlTotalStItem":0,
				         "vlPosVinco4":0,
				         "vlPosVinco3":0,
				         "vlTotalBaseStItem":0,
				         "vlPosVinco2":0,
				         "vlTotalEmbalagem":0,
				         "vlTotalItemPedido":712.32,
				         "vlFecop":0,
				         "vlPosVinco1":0,
				         "vlPosVinco8":0,
				         "vlPosVinco7":0,
				         "vlPctDescontoPromo":0,
				         "vlPosVinco6":0,
				         "vlPosVinco5":0,
				         "vlPctAcrescCliente":0,
				         "qtEstoqueCliente":0,
				         "qtItemDesejado":0,
				         "vlTotalBaseIcmsItem":0,
				         "vlVerbaItem":0,
				         "nuSeqItemPedido":1,
				         "vlIndiceFinanceiroPu":0,
				         "vlPctDescontoCondicao":0,
				         "vlFrete":0,
				         "vlTotalAdicionalFrete":0,
				         "vlTotalCofinsItem":0,
				         "vlTotalFecopItem":0,
				         "vlComissaoExtraProduto":0,
				         "vlBaseCalculoDescPromocional":29.68,
				         "nuLinhaPlanilha":0,
				         "vlPctDescontoIcms":0,
				         "vlPctDescontoCanal":0,
				         "cdLinha":0,
				         "vlPctMargemProduto":0,
				         "vlIcms":0,
				         "vlBeneficioFiscalICMS":0,
				         "cdVerbaGrupo":0,
				         "cdProduto":"2476",
				         "vlPosVinco10":0,
				         "vlItemPedidoFrete":0,
				         "cdTabelaPreco":"4",
				         "vlIndiceClienteGrupoProd":0,
				         "vlBaseItemIpi":0,
				         "qtPontosItem":0,
				         "vlTotalPisItem":0,
				         "vlSt":0,
				         "vlPctAcrescimoIcms":0,
				         "vlBaseItemPedido":29.68,
				         "vlIpiItem":0,
				         "qtPeso":0,
				         "vlPctDescCliente":0,
				         "vlPctFaixaDescQtd":0,
				         "vlDescontoPromo":0,
				         "vlAltura":0,
				         "vlPctDescontoStReverso":0,
				         "vlBaseEmbalagemElementar":0,
				         "vlTotalItemPedidoFrete":0,
				         "vlItemIpi":0,
				         "cdPrazoPagtoPreco":0,
				         "vlTotalIpiItem":0,
				         "vlCreditoFrete":0,
				         "vlVerbaItemPositivo":0,
				         "itemTabelaPreco":{
				            "vlMaxAcrescimo":0,
				            "vlMinItemPedido":0,
				            "cdItemGrade3":"0",
				            "vlPctDescPromocional":0,
				            "vlBase":0,
				            "vlMaxDesconto":0,
				            "vlPctMaxAcrescimo":0,
				            "vlReducaoOptanteSimples":0,
				            "vlDescontoPromo":0,
				            "qtMinItensNormais":0,
				            "qtMaxVenda":0,
				            "qtItem":0,
				            "vlPrecoEmbalagem":0,
				            "vlBaseEspecial":0,
				            "vlUnitario":29.68,
				            "vlEmbalagemSt":0,
				            "cdItemGrade1":"0",
				            "cdItemGrade2":"0",
				            "cdPrazoPagtoPreco":0,
				            "nuPromocao":0,
				            "vlUnitarioEspecial":0,
				            "vlPrecoEmbalagemPrimaria":0,
				            "cdLinha":0,
				            "vlPctMaxParticipacao":0,
				            "vlPctMaxDesconto":0,
				            "vlPctPrevisaRentabilidade":0,
				            "vlPctRentabilidadeMin":0,
				            "cdProduto":"2476",
				            "cdRepresentante":"513",
				            "tabelaPreco":{
				               "cdTabelaPreco":"4",
				               "cdEmpresa":"4",
				               "cdRepresentante":"513",
				               "dsTabelaPreco":"LTI"
				            },
				            "vlPrecoFrete":0,
				            "cdTabelaPreco":"4",
				            "cdEmpresa":"4",
				            "vlOportunidade":0,
				            "produto":{
				               "dsProduto":"2T SUPER 24 1L",
				               "cdEmpresa":"4",
				               "cdProduto":"2476",
				               "cdRepresentante":"513"
				            },
				            "vlPctComissao":0,
				            "nuConversaoUnidade":0,
				            "vlPctRentabilidadeEsp":0,
				            "vlPctMargemRentabilidade":0
				         },
				         "qtItemFaturamento":1,
				         "vlTotalBrutoItemPedido":712.32,
				         "vlBaseFlex":0,
				         "vlPctDesconto2":0,
				         "vlPctDesconto3":0,
				         "vlTotalCashback":0,
				         "vlPis":0,
				         "qtItemFisico":24,
				         "vlItemPedidoUnElementar":0,
				         "nuDiasPrazoEntrega":0,
				         "nuConversaoUnidadePu":0,
				         "vlItemPedidoStReverso":0,
				         "vlDesconto":0,
				         "vlDesconto3":0,
				         "vlLargura":0,
				         "vlDesconto2":0,
				         "vlTotalEncomenda":0,
				         "vlDescontoCCP":0,
				         "nuPedido":"6401152547",
				         "nuSeqOrdemCompraCliente":0,
				         "vlSeguroItemPedido":0,
				         "vlPctDesconto":0,
				         "vlBaseItemTabelaPreco":29.68,
				         "flTipoItemPedido":"V",
				         "vlIndiceGrupoProd":0,
				         "vlPctDescCondPagto":0,
				         "vlFinalPromo":0,
				         "vlComprimento":0,
				         "vlPctDescontoCCP":0,
				         "vlRentabilidade":0,
				         "vlFreteOld":0,
				         "vlPctComissao":0,
				         "vlDespesaAcessoria":0,
				         "vlTotalPrecoCusto":0,
				         "vlPctDescProgressivoMix":0,
				         "vlItemPedido":29.68
				      }
				   ],
				   "vlTotalPedidoEstoquePositivo":0
				}
								""";
	}

}
